# 第一章 基于GitLab团队协作开发

## 1、GitLab项目组内职责划分

### 1.1 项目组内人员权限划分

​	实际企业开发中，都是通过团队协作方式实现项目开发工作的，这就需要管理人员提前构建好gitlab项目组，然后将不同的开发人员拉入组内实现协作开发，那不同的人员在项目组内又有哪些权限呢？

Gitlab用户在组中有五种权限：Guest、Reporter、Developer、Owner、Maintainers

| 角色          | 权限                                       |
| ----------- | ---------------------------------------- |
| Guest       | 可以创建issue、发表评论，不能读写版本库                   |
| Reporter    | 可以克隆代码，不能提交，QA、PM可以赋予这个权限                |
| Developer   | 可以克隆代码、开发、提交、push，RD可以赋予这个权限             |
| Maintainers | 可以创建项目、添加tag、保护分支、添加项目成员、编辑项目，核心RD负责人可以赋予这个权限 |
| Owner       | 可以设置项目访问权限 - Visibility Level、删除项目、迁移项目、管理组成员，开发组leader可以赋予这个权限 |

> 名词解释：
>
> issue: 为项目提出的直到意见或者问题,但要通过讨论解决
>
> QA:质量管理职位,很多大公司有专门的质量管理部
>
> PM:产品经理
>
> RD:Research and Development,一般指核心软件开发人员

### 1.2 组内项目的权限划分

| 角色          | 权限          |
| ----------- | ----------- |
| **Private** | 只有组成员才能看到   |
| Internal    | 只要登录的用户就能看到 |
| Public      | 所有人都能看到     |

> 说明：开源项目和组设置的是public或者Internal，一般工作中用的最多的是Private



## 2、添加项目开发组

项目组一般是由项目相关负责人来构建维护，组内成员被赋予不同的操作权限；

### 2.1 创建项目组

创建项目组的流程如下：

![1652189939721](./assets/1652189939721.png)



----------------------------------

![1652189977649](./assets/1652189977649.png)

---

![1652190291062](./assets/1652190291062.png)

---

![1652190495741](./assets/1652190495741.png)

> 注意事项：
>
> 为方便gitlab运营人员维护，群组名称以：项目前缀名称、期号、群组名称以下划线间隔命名，比如：jrzs_141_g1



###  2.2. 项目组添加用户

![1652191071202](./assets/1652191071202.png)

---

![1652191105276](./assets/1652191105276.png)

---

##  3、GitLab构建项目

在用户组内构建新项目：

![1652191206369](./assets/1652191206369.png)

---

![1652191227726](./assets/1652191227726.png)



---

![1652191264919](./assets/1652191264919.png)

## 4、负责人相关配置

### 4.1 配置ssh免密登录

配置ssh免密登录（可选项）：

**1) 生成秘钥指令**

在开发者本地电脑终端窗口运行指令，生成ssh公钥：

```shell
ssh-keygen -t rsa (3个回车)
```

**2) 复制pub公钥，并在gitlab中配置，过程与配置gitee一致**

![1652694703529](./assets/1652694703529.png)



![1652694763749](./assets/1652694763749.png)

### 4.2 初始化项目

接下来项目负责人在本地构建好git仓库，并设置好git init初始化本地git仓库：

~~~shell
# 进入工程主目录，然后初始化git本地仓库
git init 
# 设置本地仓库代码提交到远程时的用户名称
git config user.name 'lisi1'
# 设置本地仓库代码提交到远程时的邮箱
git config user.email '666@163.com'
~~~

然后开发组长将初始化代码提交到远程仓库，然后构建好dev分支：

![1652695324988](./assets/1652695324988.png)

![1652695346447](./assets/1652695346447.png)

平台构建好dev分支后（也可本地构建dev分支，然后推送到远程），本地需要git fetch刷新分支最新配置；

### 4.3 设置分支保护

​	团队开发时为了避免一些重要的开发分支（master）被意外篡改，管理人员需要将这些重要的分支设置分支保护，这样普通开发人员就不能直接将代码进行推送和合并了，需要专门的分支管理人员（开发组长）维护重要分支的提交、合并操作；

设置分支保护流程如下：

![1652695696351](./assets/1652695696351.png)

---

![1652695823935](./assets/1652695823935.png)

临时禁用自动持续集成：

![1654650046001](./assets/1654650046001.png)

# 第二章 基于Git开发流程

## 1、开发人员开发流程

### 1.1 普通开发者代码拉取

构建一个文件夹，然后在文件夹中克隆工程基础代码：

~~~shell
#因为项目的私有的，所以克隆代码时，要制定对应的账户和密码，否则无权限下载；
#格式：git clone http://账号:密码@47.96.143.141:9999/jrzs_142_tmp_g2/jrzs_stock_tmp.git
$ git clone http://lisi2:12345678@47.96.143.141:9999/jrzs_142_tmp_g2/jrzs_stock_tmp.git
~~~

然后使用idea打开代码，并设置当前用户信息：

~~~shell
# 配置提交代码时用户名称标识
git config user.name 张群
# 配置邮箱标识
git config user.email 777@163.com
~~~

### 1.2 检出dev分支

接下来开发人员手动检出远程dev分支：

![1652696556897](./assets/1652696556897.png)

![1652696589506](./assets/1652696589506.png)

这样本地就会构建一个dev分支！

### 1.3 基于dev分支检出功能分支

​	对于普通开发人员来说，工作都围绕dev分支展开，而实际开发中，为了避免直接污染dev分支，一般开发人员会在dev的基础上checkout出一个功能分支：比如feature_login

![1652696705671](./assets/1652696705671.png)



### 1.4 合并功能分支到dev分支

在功能分支下开发完毕后，将代码合并到dev分支下：

![1652697000654](./assets/1652697000654.png)

![1652697038136](./assets/1652697038136.png)

到此，feature_login代码就合并到dev分支下了！

### 1.5 推送远程dev

开发人员自测代码无问题后，就可以将代码提交到远程dev分支了：

![1652697142996](./assets/1652697142996.png)

说明：开发者推送代码到dev后，一般测试人员会介入，测试ok后，分支管理人员会进行受保护分支的合并工作（在自动化工作流汇中，测试通过后，会自动合并）；

## 2、负责人合并代码到master

### 2.1 流程

管理员在合并代码之前，先把最新的dev代码拉去到本地，然后做基本的审查工作：

![1652697555636](./assets/1652697555636.png)

![1652697583012](./assets/1652697583012.png)

此时本地仓库拉取到了最新的dev代码，代码检查无误后合并到master分支：

![1652697741803](./assets/1652697741803.png)

代码合并到master分支后，提交到远程的master分支即可；

---

### 2.2 最终效果

不同的开发人员共同维护master和dev分支，最终提交记录线：

![1654911210724](./assets/1654911210724.png)

反例：

![1654911202526](./assets/1654911202526.png)

> 跨域不同的分支 合并代码，容易丢失代码；

## 3、回滚操作

通过revert提交则会产生新的提交记录，本质上就是在新的提交记录下做了逆向操作，实现回滚；

![1652698391771](./assets/1652698391771.png)



获取通过reset回滚时，最新的提交记录不会消失；

![1652699125909](./assets/1652699125909.png)

## 4、GIT打TAG

### 4.1 打标签概述

​	当项目开发到一些重要阶段后，会进行软件不同版本的发布部署工作，显然如果不记录下这些重要的历史节点，后期从繁杂的提交流水看中查找会变得非常艰难，所以git提供了为开发节点打标签的功能：

![1654657173890](./assets/1654657173890.png)

---

![1654657305526](./assets/1654657305526.png)

### 4.2 tag其它

详见：day07-实战\资料\3.项目使用GitLab流程\git打tag规范；

