# 今日指数注意问题

## day01

spingboot创建父、子工程

mybatisX插件生成依赖代码

前后端跨域问题

前后端交互统一数据封装

Java中`<T>`是什么意思



对象序列化

```java
@JsonInclude(JsonInclude.Include.NON_NULL)
private static final long serialVersionUID = 7735505903525411467L;
```



枚举



```java
StringUtils.isBlank
```



```java
BeanUtils.copyProperties(user,respVo);
```



spring security BCryptPasswordEncoder密码加密

## day02

- [x] 解决knief4j启动报错

yapi接口文档

- [x] 封装vo，调用方动态赋值


## day03

PageHelper实现MySQL分页查询。

SQL日期函数。

- [x] echarts报表。

- [x] EasyExcel。

## day04

暂无

## day05

- [x] 正则表达式
- [x] 使用ParserStockInfoUtil工具类对接口返回数据进行解析

- [x] 个股数据采集分批，多线程采集

- [x] MQ同步股票最新数据
- [x] CaffeineCache缓存

梳理CaffeineCache的使用

## day06 暂时跳过

股票流水定时多线程采集

-------------------------------------------采集前n天股票数据

## day07

暂无

## day08

暂无

## day09

- [x] 查询涨跌停数量的SQL语句较为复杂分库分表不成功。

- [x] 个股分时涨跌幅度统计功能未能正确分库分表

- [x] 个股分时K线行情功能未能正确分库分表

## day10

项目集成安全框架

## day11



## day12






























## Bug解决

### knief4j启动报错

访问swagger/Knife4j 接口文档报异常如下：`java.lang.NumberFormatException: For input string: ""`

解决过程：

移除swagger-models依赖，重新引入一个1.6.0版本的后成功解决！准确来说是swagger-models低版本当中的一个bug。

```xml
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>2.10.5</version>
    <exclusions>
        <exclusion>
            <groupId>io.swagger</groupId>
            <artifactId>swagger-models</artifactId>
        </exclusion>
    </exclusions>
</dependency>
<dependency>
    <groupId>io.swagger</groupId>
    <artifactId>swagger-models</artifactId>
    <version>1.6.0</version>
</dependency>
```

### 前端echarts图表显示不全

y坐标轴内容太长会导致内容显示不全。

在grid中做如下配置y坐标上的内容就会展示全了。

```javascript
grid: {
    left: "15%",
    containLabel: true
}
```



## 其他技巧

### 封装vo，调用方动态赋值

1. 创建一个实体类`StockInfoConfig`

```java
@ConfigurationProperties(prefix = "stock")
@Data
public class StockInfoConfig {
    //A股大盘ID集合
    private List<String> inner;
    //外盘ID集合
    private List<String> outer;
}
```

2. 在调用方工程下定义application-stock.yml文件，并配置A股大盘和外盘的编码数据：

```yaml
# 配置股票相关的参数
stock:
  inner: # A股
    - sh000001 # 上证ID
    - sz399001 #  深证ID
  outer: # 外盘
    - int_dji # 道琼斯
    - int_nasdaq # 纳斯达克
    - int_hangseng # 恒生
    - int_nikkei # 日经指数
    - b_FSSTI # 新加坡
```

3. 在主配置文件application.yml中激活该配置：

```yaml
spring:
   profiles:
   		active: stock
```

在公共配置类中加载实体VO对象：

```java
@EnableConfigurationProperties({StockInfoConfig.class})
@Configuration
public class CommonConfig {
	//省略N行
}
```

`@EnableConfigurationProperties`注解的作用是`@ConfigurationProperties`注解生效。
如果只配置`@ConfigurationProperties`注解，在IOC容器中是获取不到properties配置文件转化的bean的，当然在`@ConfigurationProperties`加入注解的类上加`@Component`也可以使交于springboot管理。

### Knife4J测试无权限

项目集成了JWT和SrpingSecurity之后，使用Knife4J进行接口测试无权限访问。

解决方法：

- 方法一：通过登录接口获取token，测试接口时在请求头填入`authorization`:`token`

- 方法二：确保swagger版本为2.10.5+，knife4j版本为2.0.6+，以使用AfterScript功能，通过登录接口登录时在AfterScript填入以下代码：

```javascript
var code=ke.response.data.code;

if(code==1){
    //判断,如果服务端响应code是1才执行操作
    //获取token
    var token=ke.response.data.data.accessToken;
    //设置当前逻辑分组下的全局Header
    ke.global.setHeader("authorization",token);
}
```

### docker容器互联

```sh
# 创建一个新的Docker网络，-d：指定网络类型，有 bridge、overlay等
# 需要参数sbnet和gateway指定网段和网关才能固定容器ip地址
$ docker network create --driver bridge --subnet 172.22.1.0/24 --gateway 172.22.1.1 网络名

# docker添加容器到网络
$ docker network connect [网络名] [容器名] --ip 172.22.1.x

# docker查看网络中的容器IP地址
$ docker inspect [网络名]

# 列出docker network
$ docker network list
```

> 通过网络中容器的ip地址实现容器间通讯

### 制作oracle jdk镜像

自行下载linux的jdk包，接着把jdk包上传到linux。

```shell
# 创建文件夹，移动jdk包到oracle-jdk文件夹下
$ mkdir oracle-jdk

# 创建dockerfile文件
$ vim dockerfile
```

下面代码复制到Dockerfile中

```dockerfile
FROM centos
# 作者名
MAINTAINER Alan
# 防止中文乱码
ENV LANG C.UTF-8
ADD jdk-8u271-linux-x64.tar.gz /root
ENV JAVA_HOME /root/jdk1.8.0_271
ENV JRE_HOME /root/jdk1.8.0_271/jre
ENV CLASSPATH $CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib
ENV PATH $JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH
# 启动容器执行的命令，仅用于验证安装配置是否正确，生产环境使用需注释后再build
ENTRYPOINT ["java","-version"]
```

生成镜像：

```css
sudo docker build -t oracle-jdk:8 .
```

验证安装是否正确，如显示Java版本则正确，注释掉启动执行命令重新编译一遍即可。

```css
docker run oracle-jdk:8
```













